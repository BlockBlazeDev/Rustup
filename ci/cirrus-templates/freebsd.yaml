# This is ci/actions-templates/linux-builds-template.yaml
# Do not edit this file in .cirrus.yml

task:
  name: FreeBSD
  freebsd_instance:
    image: freebsd-13-0-release-amd64
  setup_script: |
    pkg install -y git gmake bash
    echo "========="
    echo "create non-root user and log into it"
    pw group add -n tester
    pw user add -n tester -g tester -s `which bash`
    pw user mod tester -d `pwd`
    chown -R tester .
    sudo -u tester bash ci/cirrus-templates/script.bash
  upload_to_s3:
    only_if: $CIRRUS_BRANCH == "stable"
    script:
      - pkg install -y py36-pip bash
      - pip-3.6 install -U setuptools
      - pip-3.6 install awscli
      - bash ci/prepare-deploy.bash
      - aws s3 cp --recursive deploy/ s3://dev-static-rust-lang-org/rustup/
